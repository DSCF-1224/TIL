! ==================================================================================================================================
! [used compiler]
! gcc version 9.2.0 (Rev2, Built by MSYS2 project)
! [reference]
! http://fortranwiki.org/fortran/show/trailz
! https://www.exploringbinary.com/ten-ways-to-check-if-an-integer-is-a-power-of-two-in-c/
! ==================================================================================================================================

program test_leadz

    ! <module>s to import
    use, intrinsic :: iso_fortran_env


    ! require all variables to be explicitly declared
    implicit none


    ! support variables for this <program>
    integer(INT8)  :: itr8
    integer(INT32) :: itr32

    ! STEP.01
    ! initialization
    itr8  = 0_INT8
    itr32 = 0_INT32

    ! STEP.02
    ! test the `trailz`
    do while (.true.)

        print '(I3,1X,B12.8,5X,I2)', itr8, itr8, trailz(itr8)

        if ( itr8 .eq. huge(itr8) ) then
            exit
        else
            itr8 = itr8 +  1_INT8
        end if

    end do

    do while (.true.)

        if ( ispow2(itr32) ) then
            print '(I10,1X,B32.32,I3,I3)', itr32, itr32, trailz(itr32)
        end if

        if ( itr32 .eq. huge(itr32) ) exit

        itr32 = itr32 + 1_INT32

    end do
    
    contains
    
    pure function ispow2 (i)
    
        integer(INT32), intent(in) :: i
        logical                    :: ispow2
        
        ispow2 = (i .ne. 0_INT32) .and. ( iand(i, not(i) + 1_INT32) .eq. i )
    
    end function ispow2

end program test_leadz

! ==================================================================================================================================
! itr itr (binary) trailz
!   0     00000000      8
!   1     00000001      0
!   2     00000010      1
!   3     00000011      0
!   4     00000100      2
!   5     00000101      0
!   6     00000110      1
!   7     00000111      0
!   8     00001000      3
!   9     00001001      0
!  10     00001010      1
!  11     00001011      0
!  12     00001100      2
!  13     00001101      0
!  14     00001110      1
!  15     00001111      0
!  16     00010000      4
!  17     00010001      0
!  18     00010010      1
!  19     00010011      0
!  20     00010100      2
!  21     00010101      0
!  22     00010110      1
!  23     00010111      0
!  24     00011000      3
!  25     00011001      0
!  26     00011010      1
!  27     00011011      0
!  28     00011100      2
!  29     00011101      0
!  30     00011110      1
!  31     00011111      0
!  32     00100000      5
!  33     00100001      0
!  34     00100010      1
!  35     00100011      0
!  36     00100100      2
!  37     00100101      0
!  38     00100110      1
!  39     00100111      0
!  40     00101000      3
!  41     00101001      0
!  42     00101010      1
!  43     00101011      0
!  44     00101100      2
!  45     00101101      0
!  46     00101110      1
!  47     00101111      0
!  48     00110000      4
!  49     00110001      0
!  50     00110010      1
!  51     00110011      0
!  52     00110100      2
!  53     00110101      0
!  54     00110110      1
!  55     00110111      0
!  56     00111000      3
!  57     00111001      0
!  58     00111010      1
!  59     00111011      0
!  60     00111100      2
!  61     00111101      0
!  62     00111110      1
!  63     00111111      0
!  64     01000000      6
!  65     01000001      0
!  66     01000010      1
!  67     01000011      0
!  68     01000100      2
!  69     01000101      0
!  70     01000110      1
!  71     01000111      0
!  72     01001000      3
!  73     01001001      0
!  74     01001010      1
!  75     01001011      0
!  76     01001100      2
!  77     01001101      0
!  78     01001110      1
!  79     01001111      0
!  80     01010000      4
!  81     01010001      0
!  82     01010010      1
!  83     01010011      0
!  84     01010100      2
!  85     01010101      0
!  86     01010110      1
!  87     01010111      0
!  88     01011000      3
!  89     01011001      0
!  90     01011010      1
!  91     01011011      0
!  92     01011100      2
!  93     01011101      0
!  94     01011110      1
!  95     01011111      0
!  96     01100000      5
!  97     01100001      0
!  98     01100010      1
!  99     01100011      0
! 100     01100100      2
! 101     01100101      0
! 102     01100110      1
! 103     01100111      0
! 104     01101000      3
! 105     01101001      0
! 106     01101010      1
! 107     01101011      0
! 108     01101100      2
! 109     01101101      0
! 110     01101110      1
! 111     01101111      0
! 112     01110000      4
! 113     01110001      0
! 114     01110010      1
! 115     01110011      0
! 116     01110100      2
! 117     01110101      0
! 118     01110110      1
! 119     01110111      0
! 120     01111000      3
! 121     01111001      0
! 122     01111010      1
! 123     01111011      0
! 124     01111100      2
! 125     01111101      0
! 126     01111110      1
! 127     01111111      0
! ==================================================================================================================================
! itr        itr (binary)                     trailz
!          1 00000000000000000000000000000001  0
!          2 00000000000000000000000000000010  1
!          4 00000000000000000000000000000100  2
!          8 00000000000000000000000000001000  3
!         16 00000000000000000000000000010000  4
!         32 00000000000000000000000000100000  5
!         64 00000000000000000000000001000000  6
!        128 00000000000000000000000010000000  7
!        256 00000000000000000000000100000000  8
!        512 00000000000000000000001000000000  9
!       1024 00000000000000000000010000000000 10
!       2048 00000000000000000000100000000000 11
!       4096 00000000000000000001000000000000 12
!       8192 00000000000000000010000000000000 13
!      16384 00000000000000000100000000000000 14
!      32768 00000000000000001000000000000000 15
!      65536 00000000000000010000000000000000 16
!     131072 00000000000000100000000000000000 17
!     262144 00000000000001000000000000000000 18
!     524288 00000000000010000000000000000000 19
!    1048576 00000000000100000000000000000000 20
!    2097152 00000000001000000000000000000000 21
!    4194304 00000000010000000000000000000000 22
!    8388608 00000000100000000000000000000000 23
!   16777216 00000001000000000000000000000000 24
!   33554432 00000010000000000000000000000000 25
!   67108864 00000100000000000000000000000000 26
!  134217728 00001000000000000000000000000000 27
!  268435456 00010000000000000000000000000000 28
!  536870912 00100000000000000000000000000000 29
! 1073741824 01000000000000000000000000000000 30
! ==================================================================================================================================
